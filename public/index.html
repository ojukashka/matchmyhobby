<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MatchMyHobby - MVP Frontend</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <div class="max-w-4xl mx-auto bg-white rounded shadow p-6">
    <h1 class="text-2xl font-bold mb-4">MatchMyHobby - Nutzerverwaltung</h1>

    <form id="userForm" class="mb-6 space-y-4">
      <div>
        <label class="block font-semibold mb-1" for="name">Name:</label>
        <input id="name" type="text" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>
      <div>
        <label class="block font-semibold mb-1" for="hobbies">Hobbys (Komma getrennt):</label>
        <input id="hobbies" type="text" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>
      <div>
        <label class="block font-semibold mb-1" for="location">Ort:</label>
        <input id="location" type="text" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>
      <!-- NEU: Passwortfeld -->
      <div>
        <label class="block font-semibold mb-1" for="password">Passwort:</label>
        <input id="password" type="password" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Nutzer hinzufügen</button>
      <button type="button" id="cancelEdit" class="hidden bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-600">Bearbeitung abbrechen</button>
    </form>

    <h2 class="text-xl font-semibold mb-3">Alle Nutzer</h2>
    <div id="userList" class="space-y-3"></div>
  </div>

<script>
  const apiUrl = 'http://localhost:3000/users';
  const userForm = document.getElementById('userForm');
  const cancelEditBtn = document.getElementById('cancelEdit');
  let editingUserId = null;

  // Nutzerliste laden und anzeigen
  async function fetchUsers() {
    const res = await fetch(apiUrl);
    const users = await res.json();
    const userList = document.getElementById('userList');
    userList.innerHTML = '';

    users.forEach(user => {
      const div = document.createElement('div');
      div.className = 'border p-3 rounded bg-gray-50 flex justify-between items-center';

      div.innerHTML = `
        <div>
          <p><strong>${user.name}</strong></p>
          <p>Hobbys: ${user.hobbies.join(', ')}</p>
          <p>Ort: ${user.location}</p>
        </div>
        <div class="space-x-2">
          <button class="edit-btn bg-yellow-400 px-2 py-1 rounded">Bearbeiten</button>
          <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded">Löschen</button>
        </div>
      `;

      div.querySelector('.edit-btn').addEventListener('click', () => editUser(user._id));
      div.querySelector('.delete-btn').addEventListener('click', () => deleteUser(user._id));

      userList.appendChild(div);
    });
  }

  // Formular absenden
  userForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const hobbies = document.getElementById('hobbies').value.split(',').map(h => h.trim());
    const location = document.getElementById('location').value.trim();
    const password = document.getElementById('password').value.trim();

    if (!name || !location || hobbies.length === 0 || !password) {
      alert('Bitte alle Felder korrekt ausfüllen!');
      return;
    }

    const userData = { name, hobbies, location, password };

    if (editingUserId) {
      // Update bestehender Nutzer (ohne Passwortänderung hier, wenn gewünscht muss erweitert werden)
      const res = await fetch(`${apiUrl}/${editingUserId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, hobbies, location }),  // Passwort wird hier nicht mitgeschickt
      });
      if (res.ok) {
        alert('Nutzer erfolgreich aktualisiert!');
        resetForm();
      } else {
        alert('Fehler beim Aktualisieren!');
      }
    } else {
      // Neuen Nutzer anlegen (über den /register-Endpoint mit Passwort-Hashing im Backend)
      const res = await fetch(apiUrl + "/register", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData),
      });
      if (res.ok) {
        alert('Nutzer erfolgreich hinzugefügt!');
        resetForm();
      } else {
        alert('Fehler beim Hinzufügen!');
      }
    }
    fetchUsers();
  });

  // Bearbeiten starten
  async function editUser(id) {
    try {
      const res = await fetch(`${apiUrl}/${id}`);
      if (!res.ok) throw new Error('User nicht gefunden');
      const user = await res.json();

      document.getElementById('name').value = user.name;
      document.getElementById('hobbies').value = user.hobbies.join(', ');
      document.getElementById('location').value = user.location;

      editingUserId = id;
      userForm.querySelector('button[type="submit"]').textContent = "Nutzer aktualisieren";
      cancelEditBtn.classList.remove('hidden');
    } catch (error) {
      alert('Fehler beim Laden des Nutzers: ' + error.message);
    }
  }

  // Bearbeitung abbrechen
  cancelEditBtn.addEventListener('click', () => {
    resetForm();
  });

  // Nutzer löschen
  async function deleteUser(id) {
    if (!confirm('Möchtest du diesen Nutzer wirklich löschen?')) return;

    const res = await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });

    if (res.ok) {
      alert('Nutzer gelöscht!');
      if (editingUserId === id) resetForm();
      fetchUsers();
    } else {
      alert('Fehler beim Löschen!');
    }
  }

  // Formular zurücksetzen
  function resetForm() {
    userForm.reset();
    editingUserId = null;
    userForm.querySelector('button[type="submit"]').textContent = "Nutzer hinzufügen";
    cancelEditBtn.classList.add('hidden');
  }

  // Seite initial laden
  fetchUsers();
</script>

</body>
</html>
